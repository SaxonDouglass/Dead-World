var build = {

    patterns: [
// workshop
{ input:
[[0,48,48,48,0],
 [0,48,0,48,0],
 [0,48,0,48,0],
 [0,48,0,48,0],
 [0,48,0,48,0]],
 output:
[[0,97,97,97,0],
 [0,97,0,97,0],
 [0,97,0,97,0],
 [0,97,0,97,0],
 [0,97,96,97,0]],
    flipped: false,
},
{ input:
[[0,48,0,48,0],
 [0,48,0,48,0],
 [0,48,0,48,0],
 [0,48,0,48,0],
 [0,48,48,48,0]],
 output:
[[0,97,96,97,0],
 [0,97,0,97,0],
 [0,97,0,97,0],
 [0,97,0,97,0],
 [0,97,97,97,0]],
    flipped: true,
},
// workshop: spade
{ input:
[[0,97,97,97,0],
 [0,97,48,97,0],
 [0,97,48,97,0],
 [0,97,48,97,0],
 [0,97,96,97,0]],
 output:
[[0,97,97,97,0],
 [0,97,0,97,0],
 [0,97,128,97,0],
 [0,97,0,97,0],
 [0,97,96,97,0]],
    flipped: false,
},
{ input:
[[0,97,96,97,0],
 [0,97,48,97,0],
 [0,97,48,97,0],
 [0,97,48,97,0],
 [0,97,97,97,0]],
 output:
[[0,97,96,97,0],
 [0,97,0,97,0],
 [0,97,128,97,0],
 [0,97,0,97,0],
 [0,97,97,97,0]],
    flipped: true,
},
// workshop: pick
{ input:
[[0,97,97,97,0],
 [0,97,49,97,0],
 [0,97,48,97,0],
 [0,97,48,97,0],
 [0,97,96,97,0]],
 output:
[[0,97,97,97,0],
 [0,97,0,97,0],
 [0,97,129,97,0],
 [0,97,0,97,0],
 [0,97,96,97,0]],
    flipped: false,
},
{ input:
[[0,97,96,97,0],
 [0,97,49,97,0],
 [0,97,48,97,0],
 [0,97,48,97,0],
 [0,97,97,97,0]],
 output:
[[0,97,96,97,0],
 [0,97,0,97,0],
 [0,97,129,97,0],
 [0,97,0,97,0],
 [0,97,97,97,0]],
    flipped: true,
},

// smelter
{ input:
[[0,49,49,49,0],
 [49,49,0,49,49],
 [49,0,0,0,49],
 [49,49,0,49,49],
 [0,49,0,49,0]],
 output:
[[0,98,98,98,0],
 [98,98,0,98,98],
 [98,0,0,0,98],
 [98,98,0,98,98],
 [0,98,96,98,0]],
    flipped: false,
},
{ input:
[[0,49,0,49,0],
 [49,49,0,49,49],
 [49,0,0,0,49],
 [49,49,0,49,49],
 [0,49,49,49,0]],
 output:
[[0,98,96,98,0],
 [98,98,0,98,98],
 [98,0,0,0,98],
 [98,98,0,98,98],
 [0,98,98,98,0]],
    flipped: true,
},
// smelter: ore
{ input:
[[0,98,98,98,0],
 [98,98,50,98,98],
 [98,50,0,50,98],
 [98,98,50,98,98],
 [0,98,96,98,0]],
 output:
[[0,98,98,98,0],
 [98,98,0,98,98],
 [98,0,66,0,98],
 [98,98,0,98,98],
 [0,98,96,98,0]],
    flipped: false,
},
{ input:
[[0,98,96,98,0],
 [98,98,50,98,98],
 [98,50,0,50,98],
 [98,98,50,98,98],
 [0,98,98,98,0]],
 output:
[[0,98,96,98,0],
 [98,98,0,98,98],
 [98,0,66,0,98],
 [98,98,0,98,98],
 [0,98,98,98,0]],
    flipped: true,
},

// sawmill
{ input:
[[0,48,48,48,0],
 [48,48,0,48,48],
 [48,0,66,0,48],
 [48,48,0,48,48],
 [0,48,0,48,0]],
 output:
[[0,97,97,97,0],
 [97,97,0,97,97],
 [97,0,0,0,97],
 [97,97,0,97,97],
 [0,97,96,97,0]],
    flipped: false,
},
{ input:
[[0,48,0,48,0],
 [48,48,0,48,48],
 [48,0,66,0,48],
 [48,48,0,48,48],
 [0,48,48,48,0]],
 output:
[[0,97,96,97,0],
 [97,97,0,97,97],
 [97,0,0,0,97],
 [97,97,0,97,97],
 [0,97,97,97,0]],
    flipped: true,
},
// sawmill: planks
{ input:
[[0,97,97,97,0],
 [97,97,0,97,97],
 [97,0,48,0,97],
 [97,97,0,97,97],
 [0,97,96,97,0]],
 output:
[[0,97,97,97,0],
 [97,97,64,97,97],
 [97,64,0,64,97],
 [97,97,64,97,97],
 [0,97,96,97,0]],
    flipped: false,
},
{ input:
[[0,97,96,97,0],
 [97,97,0,97,97],
 [97,0,48,0,97],
 [97,97,0,97,97],
 [0,97,97,97,0]],
 output:
[[0,97,96,97,0],
 [97,97,64,97,97],
 [97,64,0,64,97],
 [97,97,64,97,97],
 [0,97,97,97,0]],
    flipped: true,
},

// forge
{ input:
[[49,49,49,49,49],
 [49,0,0,0,49],
 [49,66,66,66,49],
 [49,0,66,0,49],
 [49,49,0,49,49]],
 output:
[[98,98,98,98,98],
 [98,0,0,0,98],
 [98,0,0,0,98],
 [98,0,0,0,98],
 [98,98,96,98,98]],
    flipped: false,
},
{ input:
[[49,49,0,49,49],
 [49,0,0,0,49],
 [49,66,66,66,49],
 [49,0,66,0,49],
 [49,49,49,49,49]],
 output:
[[98,98,96,98,98],
 [98,0,0,0,98],
 [98,0,0,0,98],
 [98,0,0,0,98],
 [98,98,98,98,98]],
    flipped: true,
},
// forge: sword
{ input:
[[98,98,98,98,98],
 [98,0,66,0,98],
 [98,0,66,0,98],
 [98,0,64,0,98],
 [98,98,96,98,98]],
 output:
[[98,98,98,98,98],
 [98,0,0,0,98],
 [98,0,130,0,98],
 [98,0,0,0,98],
 [98,98,96,98,98]],
    flipped: false,
},
{ input:
[[98,98,96,98,98],
 [98,0,66,0,98],
 [98,0,66,0,98],
 [98,0,64,0,98],
 [98,98,98,98,98]],
 output:
[[98,98,96,98,98],
 [98,0,0,0,98],
 [98,0,130,0,98],
 [98,0,0,0,98],
 [98,98,98,98,98]],
    flipped: true,
},

// bakery
{ input:
[[0,64,64,64,0],
 [0,64,0,64,0],
 [0,64,0,64,0],
 [0,64,0,64,0],
 [0,64,0,64,0]],
 output:
[[0,99,99,99,0],
 [0,99,0,99,0],
 [0,99,0,99,0],
 [0,99,0,99,0],
 [0,99,96,99,0]],
    flipped: false,
},
{ input:
[[0,64,0,64,0],
 [0,64,0,64,0],
 [0,64,0,64,0],
 [0,64,0,64,0],
 [0,64,64,64,0]],
 output:
[[0,99,96,99,0],
 [0,99,0,99,0],
 [0,99,0,99,0],
 [0,99,0,99,0],
 [0,99,99,99,0]],
    flipped: true,
},
// bakery: bread
{ input:
[[0,99,99,99,0],
 [0,99,51,99,0],
 [0,99,51,99,0],
 [0,99,51,99,0],
 [0,99,96,99,0]],
 output:
[[0,99,99,99,0],
 [0,99,0,99,0],
 [0,99,67,99,0],
 [0,99,0,99,0],
 [0,99,96,99,0]],
    flipped: false,
},
{ input:
[[0,99,96,99,0],
 [0,99,51,99,0],
 [0,99,51,99,0],
 [0,99,51,99,0],
 [0,99,99,99,0]],
 output:
[[0,99,96,99,0],
 [0,99,0,99,0],
 [0,99,67,99,0],
 [0,99,0,99,0],
 [0,99,99,99,0]],
    flipped: true,
},

// Farm
{ input:
[[64,64,64,64,64],
 [64,0,0,0,64],
 [64,0,0,0,64],
 [64,0,0,0,64],
 [64,64,0,64,64]],
 output:
[[106,104,104,104,107],
 [105,0,0,0,105],
 [105,0,0,0,105],
 [105,0,0,0,105],
 [109,104,96,104,108]],
    flipped: false,
},
{ input:
[[64,64,0,64,64],
 [64,0,0,0,64],
 [64,0,0,0,64],
 [64,0,0,0,64],
 [64,64,64,64,64]],
 output:
[[106,104,96,104,107],
 [105,0,0,0,105],
 [105,0,0,0,105],
 [105,0,0,0,105],
 [109,104,104,104,108]],
    flipped: true,
},
// Farm: maize
{ input:
[[106,104,104,104,107],
 [105,0,0,0,105],
 [105,0,83,0,105],
 [105,0,0,0,105],
 [109,104,96,104,108]],
 output:
[[106,104,104,104,107],
 [105,0,0,0,105],
 [105,0,51,0,105],
 [105,0,0,0,105],
 [109,104,96,104,108]],
    flipped: false,
},
{ input:
[[106,104,96,104,107],
 [105,0,0,0,105],
 [105,0,83,0,105],
 [105,0,0,0,105],
 [109,104,104,104,108]],
 output:
[[106,104,96,104,107],
 [105,0,0,0,105],
 [105,0,51,0,105],
 [105,0,0,0,105],
 [109,104,104,104,108]],
    flipped: true,
},

// Thresher
{ input:
[[0,64,64,64,0],
 [64,64,0,64,64],
 [64,0,0,0,64],
 [64,64,0,64,64],
 [0,64,0,64,0]],
 output:
[[0,99,99,99,99],
 [99,99,0,0,99],
 [99,0,0,0,99],
 [99,99,0,99,99],
 [0,99,96,99,0]],
    flipped: false,
},
{ input:
[[0,64,0,64,0],
 [64,64,0,64,64],
 [64,0,0,0,64],
 [64,64,0,64,64],
 [0,64,64,64,0]],
 output:
[[0,99,96,99,0],
 [99,99,0,99,9],
 [99,0,0,0,99],
 [99,99,0,99,99],
 [0,99,99,99,0]],
    flipped: true,
},
// Thresher: maize seeds
{ input:
[[0,99,99,99,99],
 [99,99,0,0,99],
 [99,0,51,0,99],
 [99,99,0,99,99],
 [0,99,96,99,0]],
 output:
[[0,99,99,99,99],
 [99,99,0,0,99],
 [99,83,0,83,99],
 [99,99,0,99,99],
 [0,99,96,99,0]],
    flipped: false,
},
{ input:
[[0,99,96,99,0],
 [99,99,0,99,9],
 [99,0,51,0,99],
 [99,99,0,99,99],
 [0,99,99,99,0]],
 output:
[[0,99,96,99,0],
 [99,99,0,99,9],
 [99,83,0,83,99],
 [99,99,0,99,99],
 [0,99,99,99,0]],
    flipped: true,
},
// Thresher: pine seeds
{ input:
[[0,99,99,99,99],
 [99,99,0,0,99],
 [99,0,80,0,99],
 [99,99,0,99,99],
 [0,99,96,99,0]],
 output:
[[0,99,99,99,99],
 [99,99,81,0,99],
 [99,81,0,81,99],
 [99,99,81,99,99],
 [0,99,96,99,0]],
    flipped: false,
},
{ input:
[[0,99,96,99,0],
 [99,99,0,99,9],
 [99,0,80,0,99],
 [99,99,0,99,99],
 [0,99,99,99,0]],
 output:
[[0,99,96,99,0],
 [99,99,81,99,9],
 [99,81,0,81,99],
 [99,99,81,99,99],
 [0,99,99,99,0]],
    flipped: true,
},

    ],
    
    update: function () {
        
        var worldX = [1, 9, 1, 9];
        var worldY = [1, 1, 9, 9];
        
        for (var plot = 0; plot < 4; ++plot) {
            for (var p in this.patterns) {
                if ((this.patterns[p].flipped) ? !(plot < 2) : (plot < 2)) {
                    var valid = true;
                    for (var i = 0; i < 5; ++i) {
                        for (var j = 0; j < 5; ++j) {
                            if (world.getTile(worldX[plot]+i, worldY[plot]+j) != this.patterns[p].input[j][i]) {
                                valid = false;
                            }
                        }
                    }
                
                    if (valid) {
                        SoundJS.play('build', SoundJS.INTERUPT_LATE, 0.4);
                        for (var i = 0; i < 5; ++i) {
                            for (var j = 0; j < 5; ++j) {
                                world.setTile(worldX[plot]+i, worldY[plot]+j, this.patterns[p].output[j][i]);
                            }
                        }
                        player.x = worldX[plot] + 2.5;
                        if (plot > 1) {
                            player.y = worldY[plot] + 0.5;
                        } else {
                            player.y = worldY[plot] + 4.5;
                        }
                        valid = false;
                        break;
                    }
                }
            }
        }
    },
};
